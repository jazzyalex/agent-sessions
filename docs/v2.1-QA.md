# v2.1 QA Plan - Ultra Deep Testing

**Version:** 2.1
**Date:** 2025-10-07
**Focus Areas:** UI/UX, Logic, Edge Cases, Stress Testing

## Test Environment Setup

**Test Data Generation:**
1. **Tiny files**: <100 KB (baseline)
2. **Normal files**: 1-5 MB (typical usage)
3. **Large files**: 10-50 MB (at lightweight threshold)
4. **Huge files**: 100-200 MB (20x current max, stress test)
5. **Monster files**: 500+ MB (extreme edge case)

**Corrupted Data:**
1. Malformed JSON lines (missing brackets, quotes)
2. Truncated files (EOF mid-line)
3. Binary garbage data
4. Empty files
5. Files with only whitespace
6. Mixed valid/invalid JSON
7. UTF-8 encoding errors

---

## 1. UI/UX Testing (Phase 7 - Manual)

### 1.1 Visual Polish & Consistency
- [ ] **Window States**: Verify all windows open/close smoothly
- [ ] **Tab Switching**: Codex â†” Claude â†” Unified no visual glitches
- [ ] **Dark/Light Mode**: Test all views in both modes
- [ ] **Layout Modes**: Vertical â†” Horizontal split transitions smooth
- [ ] **Toolbar**: All buttons visible, no overlaps at minimum window size
- [ ] **Table Columns**: Resizing works, no content cutoff
- [ ] **Scrolling**: Smooth in sessions list, transcript view
- [ ] **Selection Highlighting**: Visible in both light/dark modes

### 1.2 Responsiveness
- [ ] **App Launch**: Time to first window <2s
- [ ] **Indexing Start**: Shows progress immediately
- [ ] **Indexing 100 sessions**: UI remains responsive during scan
- [ ] **Indexing 1000 sessions**: UI doesn't freeze
- [ ] **Large File Load**: Clicking 100MB session doesn't hang UI
- [ ] **Search Start**: Progress appears <100ms after enter
- [ ] **Filter Toggle**: Codex/Claude toggle updates <50ms
- [ ] **Column Sort**: Re-sort completes <200ms for 1000 sessions
- [ ] **Window Resize**: No lag when dragging edges

### 1.3 Loading States
- [ ] **Empty State**: "No sessions" message when directories empty
- [ ] **Indexing Progress**: Shows "Indexed 50/200" accurately
- [ ] **Search Progress**: Shows phase (small files / large files)
- [ ] **Session Loading**: Spinner appears when loading large session
- [ ] **Usage Strip**: Shows "N/A" when no data vs loading spinner
- [ ] **Transcript Loading**: Doesn't show stale data while loading

### 1.4 User Feedback
- [ ] **Selection**: Selected session clearly highlighted
- [ ] **Hover States**: Buttons show hover effect
- [ ] **Disabled States**: Grayed out when not applicable
- [ ] **Error Messages**: User-friendly (not technical stack traces)
- [ ] **Tooltips**: All buttons/controls have helpful tooltips
- [ ] **Status Messages**: Success/failure clearly communicated

### 1.5 Keyboard & Focus
- [ ] **Tab Navigation**: Can navigate entire UI with keyboard
- [ ] **Search Field**: Cmd+F focuses search
- [ ] **Find in Transcript**: Cmd+F when transcript focused
- [ ] **Arrow Keys**: Navigate sessions list
- [ ] **Enter Key**: Opens selected session
- [ ] **Escape Key**: Clears search / closes modals
- [ ] **No Focus Stealing**: Typing in search doesn't jump focus

---

## 2. Logic & Correctness Testing (Phase 2)

### 2.1 Indexing Logic
- [ ] **Codex Discovery**: Finds all .jsonl in ~/.codex
- [ ] **Claude Discovery**: Finds all sessions in ~/.claude/sessions
- [ ] **File Count**: Matches actual file count on disk
- [ ] **Duplicate Prevention**: Same file not indexed twice
- [ ] **Modification Time**: Most recent sessions appear first
- [ ] **Lightweight Parsing**: Files >10MB show estimated count
- [ ] **Full Parse**: Files <10MB fully parsed immediately
- [ ] **Mixed Sessions**: Codex + Claude sessions coexist correctly

### 2.2 Search Logic
- [ ] **Text Search**: Finds exact matches in transcript
- [ ] **Case Insensitive**: "error" matches "Error" and "ERROR"
- [ ] **No False Positives**: Doesn't match binary JSON data
- [ ] **Transcript Cache**: Uses cached transcript, not raw JSON
- [ ] **Lightweight Sessions**: Searches cached transcript for unparsed sessions
- [ ] **Large File Search**: Sequential processing doesn't freeze
- [ ] **Search Cancel**: Canceling search stops immediately
- [ ] **Search Results**: Correct count, no duplicates

### 2.3 Filter Logic
- [ ] **Codex Toggle**: ON shows only Codex sessions
- [ ] **Claude Toggle**: ON shows only Claude sessions
- [ ] **Both OFF**: Shows nothing (expected behavior)
- [ ] **Both ON**: Shows all sessions
- [ ] **Project Filter**: Double-click project â†’ filters correctly
- [ ] **Date Filter**: From/To dates filter correctly
- [ ] **Model Filter**: Shows only matching model sessions
- [ ] **Kind Filter**: Message/Tool/Meta filters work
- [ ] **Combined Filters**: All filters work together (AND logic)
- [ ] **Filter on Search**: Filters apply to search results
- [ ] **Filter Persistence**: Filters remain when switching views

### 2.4 Sorting Logic
- [ ] **Date Sort**: Ascending/Descending correct
- [ ] **Message Count**: Sorts numerically not alphabetically
- [ ] **Project Name**: Sorts alphabetically
- [ ] **Session Title**: Sorts alphabetically
- [ ] **Agent**: Groups Codex/Claude correctly
- [ ] **Sort on Search**: Column sort works on search results
- [ ] **Sort Persistence**: Sort order maintained when filtering

### 2.5 Usage Tracking
- [ ] **Codex Usage**: Shows correct 5h/week percentages
- [ ] **Claude Usage**: Shows correct session/week percentages
- [ ] **Reset Times**: Displays correctly in 24h format
- [ ] **Staleness Detection**: Shows "N/A" when data >15min old
- [ ] **Codex Timestamp**: Parses "timestamp" field correctly
- [ ] **Claude Timezone**: Strips timezone, shows consistent format
- [ ] **Format Consistency**: Codex and Claude match (HH:mm format)

---

## 3. Edge Case & Stress Testing

### 3.1 File Size Edge Cases (Phase 3)

**Test Matrix:**
| File Size | Expected Behavior | Test Status |
|-----------|-------------------|-------------|
| 0 bytes   | Empty session, no crash | â¬œ |
| 1 KB      | Fast parse | â¬œ |
| 9.9 MB    | Full parse (just under threshold) | â¬œ |
| 10 MB     | Lightweight parse (at threshold) | â¬œ |
| 10.1 MB   | Lightweight parse (just over) | â¬œ |
| 50 MB     | Lightweight parse, fast load on click | â¬œ |
| 100 MB    | Lightweight parse, loads in <5s on click | â¬œ |
| 200 MB    | Lightweight parse, loads in <10s on click | â¬œ |
| 500 MB    | Lightweight parse, doesn't crash | â¬œ |

**Validation:**
- [ ] Memory usage stays <500MB per session parse
- [ ] CPU usage <80% during large file parse
- [ ] UI remains responsive (can click cancel)
- [ ] Progress bar updates during parse
- [ ] No memory leaks after loading multiple large files

### 3.2 Line Length Edge Cases (Phase 3)
- [ ] **Single line 100 KB**: Parses correctly
- [ ] **Single line 1 MB**: Parses correctly
- [ ] **Single line 8 MB**: At JSONLReader limit, handles gracefully
- [ ] **Single line 9 MB**: Over limit, shows "[Oversize line omitted]"
- [ ] **Line with 5 MB base64 image**: Sanitized to "data:image/omitted"
- [ ] **Multiple huge lines**: All handled, doesn't accumulate memory

### 3.3 Corrupted Data Edge Cases (Phase 4)

**Malformed JSON:**
- [ ] Missing closing brace: `{"type":"message","text":"hello"`
- [ ] Extra commas: `{"type":,"text":"hello"}`
- [ ] Invalid escapes: `{"text":"hello\xworld"}`
- [ ] Non-UTF8 bytes: Binary data in middle of file
- [ ] Null bytes: \0 characters in JSON

**Expected**: Creates event with rawJSON but minimal parsing, doesn't crash

**Truncated Files:**
- [ ] EOF mid-JSON: `{"type":"message","te`
- [ ] EOF mid-line: No newline at end
- [ ] Partial first line only

**Expected**: Parses what's valid, ignores rest

**Empty/Invalid:**
- [ ] Completely empty file (0 bytes)
- [ ] Only whitespace/newlines
- [ ] Only comments: `// this is not JSON\n`
- [ ] Binary file (e.g., PNG image renamed to .jsonl)

**Expected**: Shows in list with 0 messages, doesn't crash

### 3.4 Quantity Edge Cases (Phase 2)
- [ ] **0 sessions**: Shows empty state
- [ ] **1 session**: Loads correctly
- [ ] **100 sessions**: Indexes in <5s
- [ ] **1,000 sessions**: Indexes in <30s, UI responsive
- [ ] **10,000 sessions**: Indexes, search works (may be slow)
- [ ] **Session with 0 messages**: Shows correctly
- [ ] **Session with 10,000+ messages**: Parses, transcript renders
- [ ] **Search matches 0 results**: Shows empty state
- [ ] **Search matches all results**: All displayed

### 3.5 Concurrent Operations (Phase 5)
- [ ] **Index while searching**: No race conditions
- [ ] **Filter during search**: Applies to partial results
- [ ] **Load session during search**: Doesn't interfere
- [ ] **Multiple rapid filter toggles**: Last one wins
- [ ] **Rapid column sorting**: Doesn't queue up sorts
- [ ] **Index both Codex + Claude**: Both complete correctly
- [ ] **Refresh during active usage tracking**: No conflicts

### 3.6 Memory & CPU Stress (Phase 5)

**Memory Leak Tests:**
- [ ] Index 1000 sessions â†’ memory usage
- [ ] Search 100 times â†’ memory doesn't grow
- [ ] Load 50 large sessions sequentially â†’ memory released
- [ ] Switch views 100 times â†’ no accumulation
- [ ] Filter toggle 1000 times â†’ stable memory

**CPU Usage Tests:**
- [ ] Indexing uses multiple cores efficiently
- [ ] Search doesn't peg single core at 100%
- [ ] UI updates don't block parsing threads
- [ ] Background transcript caching doesn't block UI
- [ ] Usage tracking doesn't cause CPU spikes

### 3.7 Filesystem Edge Cases (Phase 4)
- [ ] **No .codex directory**: Shows empty, doesn't crash
- [ ] **No .claude/sessions**: Shows empty, doesn't crash
- [ ] **Permission denied**: Shows error message
- [ ] **File deleted during index**: Handles gracefully
- [ ] **File modified during parse**: Uses snapshot
- [ ] **Symlinks**: Follows correctly (or ignores)
- [ ] **Hidden files**: .hidden.jsonl (decide behavior)

### 3.8 Special Characters & Unicode (Phase 4)
- [ ] **Emoji in session text**: ðŸŽ‰ displays correctly
- [ ] **RTL text**: Arabic/Hebrew doesn't break layout
- [ ] **CJK characters**: Chinese/Japanese/Korean render
- [ ] **Zero-width characters**: Don't break parsing
- [ ] **Newlines in JSON strings**: Escaped correctly
- [ ] **File paths with spaces**: Parse correctly
- [ ] **File paths with unicode**: Handle correctly

---

## 4. Integration Testing (Phase 6)

### 4.1 Resume Functionality
- [ ] **Resume Codex session**: Opens in terminal with correct state
- [ ] **Resume Claude session**: Opens in terminal/iTerm correctly
- [ ] **Resume from search results**: Works correctly
- [ ] **Resume lightweight session**: Loads full session first
- [ ] **Resume with missing binary**: Shows helpful error

### 4.2 Cross-View Consistency
- [ ] **Select in Codex view**: Same session in Unified view
- [ ] **Filter in Unified**: Applies when switching to Codex/Claude
- [ ] **Search results**: Match manual filter results
- [ ] **Usage strip**: Consistent across all views

### 4.3 Preferences & Settings
- [ ] **Hide zero-message sessions**: Applies immediately
- [ ] **Hide low-message sessions**: Filters correctly
- [ ] **Modified time display**: Relative â†” Absolute switches
- [ ] **Monochrome strip**: All colors become grayscale
- [ ] **Show reset time**: Toggles visibility
- [ ] **Custom sessions path**: Indexes correct directory

---

## 5. Regression Testing (Phase 1)

### 5.1 Previous Bug Fixes
- [ ] **Focus stealing**: Codex search doesn't steal focus
- [ ] **Find highlighting**: Works after recent changes
- [ ] **Usage N/A bug**: Shows correct times, not N/A
- [ ] **Search false positives**: No matches in binary JSON
- [ ] **Filters on search**: Now work (recently fixed)
- [ ] **Timestamp parsing**: Parses both created_at and timestamp

### 5.2 Core Functionality Unchanged
- [ ] **Basic indexing**: Still works as before
- [ ] **Session display**: No regressions in transcript rendering
- [ ] **Table interaction**: Clicking/selecting works
- [ ] **Window management**: All windows open/close

---

## 6. Performance Benchmarks (Phase 5)

**Measure & Document:**
- App launch time: `_____ s`
- Index 100 sessions: `_____ s`
- Index 1000 sessions: `_____ s`
- Search 1000 sessions (simple query): `_____ s`
- Load 10MB session: `_____ s`
- Load 100MB session: `_____ s`
- Filter toggle response: `_____ ms`
- Column sort (1000 rows): `_____ ms`
- Memory usage (idle): `_____ MB`
- Memory usage (1000 sessions indexed): `_____ MB`

---

## 7. Platform-Specific Testing (Phase 7 - Manual)

### macOS Version Matrix
- [ ] **macOS 15 (Sequoia)**: Full functionality
- [ ] **macOS 14 (Sonoma)**: Full functionality
- [ ] **macOS 13 (Ventura)**: Minimum supported version
- [ ] **Apple Silicon (M1/M2/M3)**: Optimized performance
- [ ] **Intel Mac**: Compatible, acceptable performance

---

## Test Execution Order

### **Phase 1: Regression Tests** (Automated - 15 min)
- Previous bug fixes validation
- Core functionality smoke tests
- Build and unit tests

### **Phase 2: Logic Testing** (Automated - 30 min)
- Indexing correctness
- Search accuracy
- Filter/sort validation
- Usage tracking
- Quantity edge cases

### **Phase 3: File Size Edge Cases** (Automated - 45 min)
- Generate test files (0B to 500MB)
- Parse and validate behavior
- Memory/CPU monitoring
- Line length limits

### **Phase 4: Corrupted Data** (Automated - 30 min)
- Malformed JSON tests
- Truncated files
- Empty/invalid files
- Filesystem edge cases
- Unicode/special characters

### **Phase 5: Stress & Performance** (Automated - 1 hour)
- Concurrent operations
- Memory leak detection
- CPU usage profiling
- Performance benchmarks

### **Phase 6: Integration** (Semi-automated - 20 min)
- Cross-view consistency checks
- Preferences validation
- Resume functionality (requires terminal)

### **Phase 7: UI/UX Manual Testing** (Manual - 1 hour)
- Visual polish
- Responsiveness
- Loading states
- User feedback
- Keyboard navigation
- Platform-specific testing

**Total Automated: ~3 hours**
**Total Manual: ~1.5 hours**
**Grand Total: ~4.5 hours**

---

## Success Criteria

**Must Pass:**
- âœ… No crashes during any test
- âœ… All corrupted data handled gracefully
- âœ… UI remains responsive during stress tests
- âœ… Memory usage <1GB even with extreme data
- âœ… Search finds correct results (no false positives)
- âœ… Filters/sorting work on search results
- âœ… Large files (200MB) load within 10s

**Should Pass:**
- âœ… All UI polish items complete
- âœ… Performance benchmarks acceptable
- âœ… No regressions from previous bugs
- âœ… Cross-platform compatibility

**Document Known Limitations:**
- Files >500MB may take >30s to load
- 10,000+ sessions may slow search
- Binary files show as 0-message sessions (working as designed)

---

## Automated Test Script Additions Needed

```swift
// File size handling
testLightweightThreshold_ExactlyAt10MB()
testLightweightThreshold_JustUnder10MB()
testLightweightThreshold_Over100MB()

// Corrupted JSON
testMalformedJSON_MissingBrace()
testMalformedJSON_InvalidEscape()
testEmptyFile()
testBinaryFile()

// Edge cases
testZeroMessageSession()
testSessionWithoutTimestamp()
testOversizeLine()
testLineAt8MBLimit()

// Search logic
testSearchUsesTranscriptNotRawJSON()
testSearchNoFalsePositives()
testFiltersDuringSearch()

// Memory
testNoMemoryLeakAfterMultipleLoads()
testTranscriptCacheDoesntGrow()
```

---

## Test Results Log

**Phase 1 Results:**
```
Date: ___________
Status: â¬œ Pass / â¬œ Fail
Notes:
```

**Phase 2 Results:**
```
Date: ___________
Status: â¬œ Pass / â¬œ Fail
Notes:
```

**Phase 3 Results:**
```
Date: ___________
Status: â¬œ Pass / â¬œ Fail
Notes:
```

**Phase 4 Results:**
```
Date: ___________
Status: â¬œ Pass / â¬œ Fail
Notes:
```

**Phase 5 Results:**
```
Date: ___________
Status: â¬œ Pass / â¬œ Fail
Notes:
```

**Phase 6 Results:**
```
Date: ___________
Status: â¬œ Pass / â¬œ Fail
Notes:
```

**Phase 7 Results:**
```
Date: ___________
Status: â¬œ Pass / â¬œ Fail
Notes:
```

---

## Issues Found

| # | Phase | Severity | Description | Status | Fixed In |
|---|-------|----------|-------------|--------|----------|
| 1 | | | | â¬œ Open / â¬œ Fixed | |
| 2 | | | | â¬œ Open / â¬œ Fixed | |
| 3 | | | | â¬œ Open / â¬œ Fixed | |
